<!-- ANT build script for yfiles obfuscation           -->
<!-- The java based ANT tool is available from         -->
<!-- http://jakarta.apache.org/ant                     -->
   	
<project
  name="KEGGtranslator with Obfuscation"
  default="sign"
  basedir="."
>

  <target
	name="help"
  	description="displays a help message."
  >
    <echo>
      This is an ANT build script to build a stand-alone JAR for
	    KEGGtranslator. In the last step, obfuscating of all yFiles
    	classes and all other classes that make use of yFiles is
	    performed.
    	
    	To make this script work, actually only 3 properties are needed:
	    SysBioPath, JSBMLPath and SBML2LaTeXPath.
	    	
	    The resulting redistributable is the OBFUSCATED and SIGNED jar
	    file, stored in $appJarObfSgn which is today
	    "KEGGtranslatorObfSgn.jar".
    </echo>
  </target>

  <target
  	name="init"
  	description="define some properties that are used throughout the tasks"
  >
  	<echo>
  	  PLESE MAKE SURE LOG LEVEL IN Translator.java MAIN METHOD IS SET TO INFO!
  	</echo>
    <!-- the base directory of the KEGGtranslator repository -->
    <property name="base" location=".."/>
  	
  	<property name="version" value="2.5"/>
  	
  	<!-- the path to SYSBIO -->
  	<property name="SysBioPath" location="${base}/../SysBio" />

    <!-- the path to JSBML -->
     <property name="JSBMLPath" location="${base}/../jSBML" />
  	
    <!-- the path to SBML2LaTeX -->
     <property name="SBML2LaTeXPath" location="${base}/../SBML2LaTeX" />
  	
    <!-- the path to the KEGGtranslator sources -->
  	<property name="src" location="${base}/src"/>
  	
    <!-- the path to the KEGGtranslator binaries -->
    <property name="classes" location="${base}/bin"/>
    
    <!-- the unobfuscated application jar file -->
    <property name="appJar" value="KEGGtranslator.jar"/>

    <!-- the obfuscated application jar file -->
    <property name="appJarObf" value="KEGGtranslatorObf.jar"/>

    <!-- the obfuscated and signed application jar file -->
    <property name="appJarObfSgn" value="KEGGtranslator_v${version}.jar"/>
  	
    <!-- the yGuard jar file containing the obfuscation task -->
    <property name="yGuardJar" value="yguard.jar"/>
  	
    <!-- the log file geenrated by the obfuscation task -->
    <property name="obfuscationLog" value="obfuscation-log.xml"/>
  	
  	<property name="build.compiler" value="modern"/>
  	
  </target>

  <target
	name="jar"
  	depends="init"
  	description="puts the application specific classes into application.jar."
  >
    <jar jarfile="${appJar}" update="false">
            <manifest>
              <attribute name="Main-Class" value="de.zbit.kegg.Translator"/>
              <attribute name="Built-By" value="Center for Bioinformatics Tuebingen (ZBIT)"/>
              <attribute name="SplashScreen-Image" value="de/zbit/kegg/gui/img/Logo.gif"/>
            	<!-- Die folgenden 2 Attribute sind leider keine gÃ¼ltigen manifest attribute. -->
            	<!--<attribute name="Xdock:name" value="KEGGtranslator"/>-->
              <!--<attribute name="Xdock:icon" value="de/zbit/kegg/gui/img/KEGGtranslatorIcon_256.png"/>-->
            </manifest>
      <!-- INCLUDE/ EXCLUDE DEMO-->
      <!--<fileset dir="${src}">-->
      <!--  <include name="demo/view/**/*.properties"/>-->
      <!--  <exclude name="demo/view/**/resource/**"/>-->
      <!--</fileset>-->
            <fileset dir="${classes}">
            	<exclude name="**/package.html"/>
            </fileset>	
            <zipfileset excludes="META-INF/*.SF" src="${base}/lib/y.jar"/>
            <!-- <zipfileset excludes="META-INF/*.SF" src="${base}/lib/HotEqn.jar"/> -->
            <!-- <zipfileset excludes="META-INF/*.SF" src="${base}/lib/stax-api-1.0.1.jar"/> -->
    	
            <zipfileset excludes="overview.html,META-INF/**/*,org/apache/commons/logging/**/*,javax/xml/namespace/QName.class,org/apache/log4j/**/*" src="${base}/lib/paxtools-4.1.1_customJenaFix.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${base}/lib/org.sbgn.jar"/>

    	
    	      <filelist dir="${basedir}" files="libquaqua.jnilib,libquaqua64.jnilib"/>

<!-- Uncomment for SysBio classes instead of compiled jar. -->
           <fileset dir="${SysBioPath}/bin">
              <exclude name="de/zbit/resources/liftover/**/*"/>
           	  <exclude name="de/zbit/mapper/**/*"/>
            	<exclude name="**/package.html"/>
           	  <exclude name="overview.html"/>
           </fileset>
<!-- Achtung, im ersten SysBio release befinden sich bugs in KeggInfos.java ! -->
<!--    	      <zipfileset excludes="META-INF/*,de/zbit/resources/liftover/*,**/package.html" src="${base}/lib/sysbio_v1_light.jar"/> -->
    	
            <zipfileset excludes="META-INF/*" src="${SysBioPath}/lib/commons-discovery.jar"/>
            <zipfileset excludes="META-INF/*" src="${SysBioPath}/lib/commons-logging.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${SysBioPath}/lib/jaxrpc.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${SysBioPath}/lib/wsdl4j.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${SysBioPath}/lib/axis.jar"/>
    	    <zipfileset excludes="META-INF/*.SF" src="${SysBioPath}/lib/sysbio-osx-support.jar"/>
            <zipfileset excludes="META-INF/*" src="${SysBioPath}/lib/quaqua.jar"/>
            <!-- <zipfileset excludes="META-INF/*.SF" src="${SysBioPath}/lib/Java5/saaj.jar"/>-->
            <!-- <zipfileset excludes="META-INF/*.SF" src="${SysBioPath}/lib/WSDbfetch.jar"/>-->
            <zipfileset excludes="META-INF/*" src="${SysBioPath}/lib/commons-cli-1.1.jar"/>
            
            <fileset dir="${JSBMLPath}/bin">
              <exclude name="log4j.properties"/> <!-- log4j.properties is in SBML2Latex and jSBML -->
            </fileset>
            <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/core/lib/biojava-1.7-ontology.jar"/>
            <!-- <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/lib/junit-4.8.jar"/>-->
            <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/core/lib/log4j-1.2.8.jar"/>
            <!-- <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/lib/stax-api-1.0.1.jar"/> -->
            <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/core/lib/staxmate-2.0.0.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/core/lib/xstream-1.3.1.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/core/lib/jigsaw-dateParser.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/core/lib/stax2-api-3.0.3.jar"/>
            <zipfileset excludes="META-INF/*.SF,META-INF/LICENSE*" src="${JSBMLPath}/core/lib/woodstox-core-lgpl-4.0.9.jar"/>
            
    </jar>
  </target>

  <target
  	name="obfuscate"
  	depends="jar"
  	description="obfuscates y.jar and adjusts application.jar accordingly. Generates the jar files yObf.jar and applicationObf.jar."
  >
    <taskdef name="yguard" classname="com.yworks.yguard.YGuardTask" classpath="${yGuardJar}"/>
    <yguard>

      <!-- obfuscate yFiles for public deployment -->
  	  <!-- <inoutpair in="${yJar}" out="${yJarObf}"/> -->
      <!-- adjust your application accordingly to work with the obfuscated yFiles jar  -->
      <inoutpair in="${appJar}" out="${appJarObf}"/>

      <!-- [OPTIONALLY] Keep the line number table and the source file attributes
                 of the public part of the "application" -->
      <attribute name="LineNumberTable,LocalVariableTable,SourceFile">
        <patternset>
          <include name="de.zbit.**"/>
        </patternset>
      </attribute>

      <rename logfile="${obfuscationLog}" replaceClassNameStrings="true" mainclass="de.zbit.kegg.Translator">
        <!-- conservemanifest="true" -->
        <!-- use some unique package prefix for obfuscated classes to avoid name clashes -->
        <property name="obfuscation-prefix" value="kgtrans"/>


        <keep>
        
        	<package>
        		<patternset>
          	  <include name="de.**.*"/>
        		</patternset>
        	</package>

          
             <!-- Keep all method, field, and class names of the "application"             -->
             <!-- This could be adjusted to your needs if you don't want to let            -->
             <!-- your whole application unobfuscated.                                     -->
             <!-- In that case simply add some more "exclude" statements as depicted below -->
             <class classes="private" methods="private" fields="private">
              <patternset>
              	<!-- Do not obfuscate anything, by default -->
               <include name="**.*"/>

                <!-- Obfuscate all classes that make use of y.jar -->
                <exclude name="de.zbit.kegg.gui.TranslatorPanel"/>

                <exclude name="de.zbit.kegg.ext.GenericDataMap"/>
              	
              	<exclude name="de.zbit.util.TranslatorTools"/>
              	
                <exclude name="de.zbit.kegg.io.KEGG2yGraph"/>
                <exclude name="de.zbit.kegg.io.YFilesWriter"/>
              	
              	<exclude name="de.zbit.graph.CollapseGroupNodesViewMode"/>
                <exclude name="de.zbit.graph.RestrictedEditMode"/>
                <exclude name="de.zbit.graph.RestrictedEditModeV2"/>
              	<exclude name="de.zbit.graph.SearchSupport"/>
              	<exclude name="de.zbit.graph.StackingNodeLayout"/>
              	
               <!-- Obfuscate the included y.jar -->
               <exclude name="y.**.*"/>
              </patternset>
             </class>
        		
        </keep>

        <!-- make sure that the .properties files are renamed according to their               -->
        <!-- corresponding class files, yFiles needs this to function properly when obfuscated -->
        <adjust replaceName="true">
          <include name="y/**/*.properties"/>
        </adjust>
      </rename>
    </yguard>
  </target>

  <target
	name="sign"
  	depends="obfuscate"
  	description="signs the obfuscated application"
  >
    <!-- Having an "keystore" file is required. Generate it with the "keytool" in the current directory. -->  	
	  <signjar alias="KEGGtranslator" jar="${appJarObf}" keypass="d=dpfKEGGtranslator!" keystore="keystore" signedjar="${appJarObfSgn}" storepass="d=dpfKEGGtranslator!"/>
  </target>

  <target name="run" depends="obfuscate" description="executes the obfuscated application">
    <java classname="de.zbit.kegg.Translator" fork="true">
      <classpath>
        	<!-- <pathelement location="${yJarObf}"/> -->
        <pathelement location="${appJarObf}"/>
      </classpath>
    </java>
  </target>

  <target
  	name="show"
  	depends="obfuscate"
  	description="opens a small browser that shows the name mapping performed by yGuard."
  >
    <echo message="${obfuscationLog}"/>
    <java jar="${yGuardJar}" fork="true">
      <arg value="${obfuscationLog}"/>
    </java>
  </target>

  <target
  	name="clean"
  	depends="init"
  	description="Removes all that has been built"
  >
  	<!-- <delete file="${yJarObf}"/> -->
  	<delete file="${appJar}"/>
    <delete file="${appJarObf}"/>
    <delete file="${obfuscationLog}"/>
    <delete includeemptydirs="true" dir="${classes}"/>
    <delete file="${appJarObfSgn}"/>
  </target>
	
	
  <!-- =================================================================== -->
  <!-- Creates a ZIP file for Garuda                                       -->
  <!-- =================================================================== -->
  <target
    name="garuda"
  	depends="init"
    description="Creates a ZIP file for Garuda">
    
  	<property name="Name"          value="KEGGtranslator"/>
  	<property name="dist"          value="${basedir}"/>
  	<property name="dist.dir"      value="${dist}/${Name}-${version}"/>
  	<property name="garuda.gadget" value="${dist.dir}/${appJarObfSgn}_Garuda.zip"/>
  	<property name="resources"     value="${base}/resources"/>
  	
  	<property name="uuid"           value="a4978d67-f0b0-4f91-abc6-0cc7b848cd53"/>
  	<property name="gadget.config"  value="${dist}/gadget_config.xml"/>
  	
  	<echo message="Updating Garuda gadget configuration..."/>
  	<replace
      file="${gadget.config}"
      token="[GADGET_UUID]"
      value="${uuid}"
    />
  	<replace
      file="${gadget.config}"
      token="[JAR_NAME]"
      value="${appJarObfSgn}"
  	/>
  	
  	<echo message="Generating ZIP archive for Garuda..."/>
  	<zip
      compress="true"
      comment="Garuda Gadget ${Name}"
      destfile="${garuda.gadget}"
      encoding="utf-8"
      level="9"
      update="true"
   	>
      <mappedresources>
        <fileset file="${gadget.config}"/>
          <globmapper from="*" to="${uuid}/*"/>
        </mappedresources>
      <mappedresources>
        <fileset file="${appJarObfSgn}"/>
        <globmapper from="*" to="${uuid}/*"/>
      </mappedresources>
      <mappedresources>
        <fileset file="${resources}/de/zbit/kegg/gui/img/${Name}Icon_64.png"/>
        <globmapper from="*" to="${uuid}/icons/*"/>
      </mappedresources>
      <mappedresources>
        <fileset file="${dist}/Screenshot_1.png"/>
        <globmapper from="*" to="${uuid}/snapshot/*"/>
      </mappedresources>
      <mappedresources>
        <fileset file="${dist}/Screenshot_2.png"/>
        <globmapper from="*" to="${uuid}/snapshot/*"/>
      </mappedresources>
      <mappedresources>
        <fileset file="${dist}/Screenshot_3.png"/>
        <globmapper from="*" to="${uuid}/snapshot/*"/>
      </mappedresources>
    </zip>
  	
  	<echo message="Reverting changes in Garuda gadget configuration file..."/>
  	<replace
      file="${gadget.config}"
      token="${uuid}"
      value="[GADGET_UUID]"
  	/>
  	<replace
      file="${gadget.config}"
      token="${appJarObfSgn}"
      value="[JAR_NAME]"
  	/>

  </target>
	
  <!-- =================================================================== -->
  <!-- Creates a minimal SysBio JAR                                        -->
  <!-- =================================================================== -->
  <target
    name="minimal_sysbio"
    depends="init"
    description="Build a minimal version of SysBio for KEGGtranslator"
  >
    <!-- The relative path of the SysBio project -->
  	<property name="lib" value="${base}/lib"/>
  	<property name="sysbio.lib" value="${SysBioPath}/lib"/>
    <path id="sysbio.classpath">
      <fileset dir="${sysbio.lib}" includes="**.jar, **/*.jar, **.zip"/>
    </path>
    <path id="sysbio.sourcepath">
      <fileset dir="${SysBioPath}/src"/>
      <fileset dir="${SysBioPath}/test"/>
      <fileset dir="${SysBioPath}/resources"/>
      <fileset dir="${SysBioPath}/examples"/>
    </path>
    
  	<echo message="Determining the revision number of SysBio"/>
    <exec executable="svn" outputproperty="svninfo.xml">
      <arg line="info --xml"/>
    </exec>
    <xmlproperty collapseAttributes="true">
      <propertyresource name="svninfo.xml"/>
    </xmlproperty>
		<property name="sysbio.revision" value="${info.entry.revision}"/>

    <echo message="Deleting all previous versions of SysBio JAR files"/>
    <delete verbose="true">
      <fileset dir="${lib}">
        <include name="SysBio**.jar"/>
      </fileset>
    </delete>

    <echo message="Compile the entire SysBio project"/>
    <delete dir="${SysBioPath}/bin"/>
    <mkdir dir="${SysBioPath}/bin"/>
    <javac
      classpathref="sysbio.classpath"
      compiler="${build.compiler}"
      debug="${debug}"
      deprecation="${deprecation}"
      destdir="${SysBioPath}/bin"
      listfiles="yes"
      memoryMaximumSize="512M"
      nowarn="no"
      optimize="${optimize}"
      source="1.6"
      srcdir="${SysBioPath}/src"
      sourcepathref="sysbio.sourcepath"
      target="1.6"
      verbose="${verbose}"
    />
    <!-- <copy todir="${SysBioPath}/bin"/> -->

    <echo message="Packing a minimal JAR file containing only parts required for KEGGtranslator"/>
    <jar
      compress="true"
      filesetmanifest="mergewithoutmain"
      index="true"
      indexMetaInf="true"
    jarfile="${lib}/SysBio.jar"
      level="9"
      manifestencoding="utf-8"
      strict="warn"
      update="true"
    >
      <manifest>
        <attribute name="Built-By" value="${user.name}"/>
        <section name="SysBio">
          <attribute name="Specification-Title"    value="SysBio"/>
          <attribute name="Specification-Version"  value="Revision ${sysbio.revision}"/>
          <attribute name="Specification-Vendor"   value="Center for Bioinformatics Tuebingen (ZBIT)"/>
          <attribute name="Implementation-Title"   value="SysBio"/>
          <attribute name="Implementation-Version" value="Revision ${sysbio.revision} ${TODAY} (Build ${DSTAMP}-${TSTAMP})"/>
          <attribute name="Implementation-Vendor"  value="University of Tuebingen"/>
        </section>
      </manifest>
      <fileset dir="${SysBioPath}">
        <include name="licenses/COPYING.txt"/>
        <include name="licenses/lib-licenses/*.txt"/>
        <include name="licenses/lib-licenses/*.html"/>
        <include name="licenses/AUTHORS.txt"/>
      </fileset>
      <fileset dir="${SysBioPath}/bin" excludes="**/.svn*, **/package-info.class">
        <include name="de/zbit/**.class"/>
        <include name="de/zbit/cache/**.class"/>
        <include name="de/zbit/collection/**.class"/>
      	<include name="de/zbit/dbfetch/**.class"/>
      	<include name="de/zbit/exception/**.class"/>
        <include name="de/zbit/garuda/**.class"/>
      	<include name="de/zbit/graph/**.class"/>
      	<include name="de/zbit/graph/gui/**.class"/>
      	<include name="de/zbit/graph/gui/options/**.class"/>
      	<include name="de/zbit/graph/io/**.class"/>
      	<include name="de/zbit/graph/io/def/**.class"/>
        <include name="de/zbit/gui/**.class"/>
        <include name="de/zbit/gui/csv/**.class"/>
        <include name="de/zbit/gui/actioncommand/**.class"/>
        <include name="de/zbit/gui/layout/**.class"/>
        <exclude name="de/zbit/gui/layout/SpringUtilities.class"/>
        <exclude name="de/zbit/gui/layout/VerticalLayout.class"/>
        <include name="de/zbit/gui/panels/**.class"/>
        <include name="de/zbit/gui/prefs/**.class"/>
        <include name="de/zbit/gui/table/**.class"/>
        <include name="de/zbit/gui/table/renderer/**.class"/>
        <include name="de/zbit/gui/wizard/**.class"/>
        <include name="de/zbit/gui/**.class"/>
        <include name="de/zbit/io/**.class"/>
      	<include name="de/zbit/io/bzip2/**.class"/>
      	<include name="de/zbit/io/csv/**.class"/>
      	<include name="de/zbit/io/filefilter/**.class"/>
      	<include name="de/zbit/io/fileformat/**.class"/>
      	<include name="de/zbit/io/tar/**.class"/>
      	<include name="de/zbit/kegg/**.class"/>
      	<include name="de/zbit/kegg/api/**.class"/>
      	<include name="de/zbit/kegg/api/cache/**.class"/>
      	<include name="de/zbit/kegg/gui/**.class"/>
      	<include name="de/zbit/kegg/io/**.class"/>
      	<include name="de/zbit/kegg/parser/**.class"/>
      	<include name="de/zbit/kegg/parser/pathway/**.class"/>
      	<include name="de/zbit/kegg/parser/pathway/ext/**.class"/>
      	<include name="de/zbit/locales/**.class"/>
        <include name="de/zbit/math/**.class"/>
      	<include name="de/zbit/parser/**.class"/>
        <include name="de/zbit/resources/**.class"/>
        <include name="de/zbit/sbml/**.class"/>
        <include name="de/zbit/sbml/gui/*.class"/>
        <include name="de/zbit/sbml/io/*.class"/>
        <include name="de/zbit/sbml/layout/*.class"/>
        <exclude name="de/zbit/sbml/layout/y"/>
        <include name="de/zbit/sbml/util/*.class"/>
        <include name="de/zbit/text/**.class"/>
        <include name="de/zbit/util/*.class"/>
      	<include name="de/zbit/util/argparser/**.class"/>
      	<include name="de/zbit/util/liftOver/**.class"/>
      	<include name="de/zbit/util/liftOver/io/**.class"/>
      	<include name="de/zbit/util/liftOver/util/**.class"/>
      	<include name="de/zbit/util/logging/**.class"/>
        <include name="de/zbit/util/objectwrapper/**.class"/>
        <include name="de/zbit/util/prefs/**.class"/>
        <include name="de/zbit/util/progressbar/**.class"/>
      	<include name="de/zbit/util/progressbar/gui/**.class"/>
        <include name="de/zbit/util/**.class"/>
      	<include name="keggapi/**.class"/>
      </fileset>
      <fileset dir="${SysBioPath}/resources" excludes="**/.svn*, package-info.*">
        <include name="de/zbit/garuda/img/**.png"/>
        <include name="de/zbit/garuda/locales/**.xml"/>
        <include name="de/zbit/gui/img/**.png"/>
        <include name="de/zbit/locales/**.xml"/>
        <include name="de/zbit/sbml/locales/**.xml"/>
      	<include name="de/zbit/resources/liftover/**"/>
      </fileset>
      <zipfileset excludes="META-INF/*" src="${SysBioPath}/lib/sysbio-osx-support.jar"/>
    </jar>

  </target>
	
  <!-- =================================================================== -->
  <!-- Creates a minimal JSBML JAR                                         -->
  <!-- =================================================================== -->
  <target
    name="minimal_jsbml"
    depends="init"
    description="Build a minimal version of JSBML for KEGGtranslator"
  >
  	<echo message="Defining basic properties of the JSBML project"/>
  	<property name="jsbml.dir" value="${base}/../JSBML"/>
  	<property name="jsbml.name" value="JSBML"/>
  	<property name="jsbml.version" value="1.0-a1"/>
  	<property name="lib" value="${base}/lib"/>
  	
  	
    <echo message="Determining the revision number of JSBML"/>
    <exec executable="svn" outputproperty="svninfo.xml">
      <arg line="info --xml"/>
    </exec>
    <xmlproperty collapseAttributes="true">
      <propertyresource name="svninfo.xml"/>
    </xmlproperty>
		<property name="jsbml.revision" value="${info.entry.revision}"/>

    <echo message="Compiling the entire JSBML project"/>
    <delete dir="${jsbml.dir}/bin"/>
    <mkdir dir="${jsbml.dir}/bin"/>
  	
  	<path id="jsbml.classpath">
    <fileset dir="${jsbml.dir}/core/lib" includes="**.jar, **/*.jar, **.zip"/>
  	</path>

  	<!-- Compile JSBML including core and all extension packages -->
  	<javac
    classpathref="jsbml.classpath"
    compiler="${build.compiler}"
    debug="${debug}"
    deprecation="${deprecation}"
    destdir="${jsbml.dir}/bin"
    includeantruntime="false"
    listfiles="yes"
    memoryMaximumSize="512M"
    nowarn="no"
    optimize="${optimize}"
    source="1.6"
    target="1.6"
    verbose="${verbose}"
  	>
      <!-- Source -->
      <src path="${jsbml.dir}/core/src"/>
      <src path="${jsbml.dir}/extensions/comp/src"/>
      <src path="${jsbml.dir}/extensions/fbc/src"/>
      <src path="${jsbml.dir}/extensions/groups/src"/>
      <src path="${jsbml.dir}/extensions/layout/src"/>
      <src path="${jsbml.dir}/extensions/multi/src"/>
      <src path="${jsbml.dir}/extensions/qual/src"/>
      <src path="${jsbml.dir}/extensions/render/src"/>
      <src path="${jsbml.dir}/extensions/req/src"/>
      <src path="${jsbml.dir}/extensions/spatial/src"/>
      <!-- Resources -->
      <src path="${jsbml.dir}/core/resources"/>
      <src path="${jsbml.dir}/extensions/comp/resources"/>
      <src path="${jsbml.dir}/extensions/fbc/resources"/>
      <src path="${jsbml.dir}/extensions/groups/resources"/>
      <src path="${jsbml.dir}/extensions/layout/resources"/>
      <src path="${jsbml.dir}/extensions/multi/resources"/>
      <src path="${jsbml.dir}/extensions/qual/resources"/>
      <src path="${jsbml.dir}/extensions/render/resources"/>
    <src path="${jsbml.dir}/extensions/req/resources"/>
      <src path="${jsbml.dir}/extensions/spatial/resources"/>
  	</javac>
  	  	
    <copy file="${jsbml.dir}/AUTHORS.txt" tofile="${jsbml.dir}/core/licenses/JSBML-AUTHORS.txt"/>
  	
    <echo message="Packing a minimal JAR file containing only parts required for KEGGtranslator"/>
    <jar
      compress="true"
      filesetmanifest="mergewithoutmain"
      index="true"
      indexMetaInf="true"
      jarfile="${lib}/jsbml-1.0-a1-with-dependencies.jar"
      level="9"
      manifestencoding="utf-8"
      strict="warn"
      update="true"
    >
      <manifest>
      	<section name="${jsbml.name}">
          <attribute name="Specification-Title" value="${jsbml.name}"/>
          <attribute name="Specification-Version" value="${jsbml.version}"/>
          <attribute name="Implementation-Title" value="${jsbml.name}"/>
        <attribute name="Implementation-Version" value="Revision ${jsbml.revision} (Build ${DSTAMP}-${TSTAMP})"/>
        </section>
      </manifest>
      <fileset
        dir="${jsbml.dir}/bin"
      	includes="META-INF/**"
      />
    	
      <!-- Licenses -->
      <fileset dir="${jsbml.dir}/core">
        <include name="licenses/COPYING.txt"/>
      	<include name="licenses/COPYING.html"/>
        <include name="licenses/lib-licenses/*.txt"/>
        <include name="licenses/lib-licenses/*.html"/>
        <include name="licenses/JSBML-AUTHORS.txt"/>
      </fileset>
      <!-- Binaries -->
      <fileset
      	dir="${jsbml.dir}/bin"
    	includes="**.class **/*.class"
    	excludes="**/.svn*, **/package-info.class"
      />
      <!-- Resources -->
      <fileset dir="${jsbml.dir}/core/resources" includes="**.txt, **/*.txt, **.xml, **/*.xml, **.properties, **/*.properties, **.cfg, **/*.cfg, **.obo, **/*.obo"/>
      <fileset dir="${jsbml.dir}/extensions/comp/resources" includes="**.txt, **/*.txt, **.xml, **/*.xml, **.properties, **/*.properties, **.cfg, **/*.cfg, **.obo, **/*.obo"/>
      <fileset dir="${jsbml.dir}/extensions/fbc/resources" includes="**.txt, **/*.txt, **.xml, **/*.xml, **.properties, **/*.properties, **.cfg, **/*.cfg, **.obo, **/*.obo"/>
      <fileset dir="${jsbml.dir}/extensions/groups/resources" includes="**.txt, **/*.txt, **.xml, **/*.xml, **.properties, **/*.properties, **.cfg, **/*.cfg, **.obo, **/*.obo"/>
      <fileset dir="${jsbml.dir}/extensions/layout/resources" includes="**.txt, **/*.txt, **.xml, **/*.xml, **.properties, **/*.properties, **.cfg, **/*.cfg, **.obo, **/*.obo"/>
      <fileset dir="${jsbml.dir}/extensions/multi/resources" includes="**.txt, **/*.txt, **.xml, **/*.xml, **.properties, **/*.properties, **.cfg, **/*.cfg, **.obo, **/*.obo"/>
      <fileset dir="${jsbml.dir}/extensions/qual/resources" includes="**.txt, **/*.txt, **.xml, **/*.xml, **.properties, **/*.properties, **.cfg, **/*.cfg, **.obo, **/*.obo"/>
      <fileset dir="${jsbml.dir}/extensions/render/resources" includes="**.txt, **/*.txt, **.xml, **/*.xml, **.properties, **/*.properties, **.cfg, **/*.cfg, **.obo, **/*.obo"/>
      <fileset dir="${jsbml.dir}/extensions/spatial/resources" includes="**.txt, **/*.txt, **.xml, **/*.xml, **.properties, **/*.properties, **.cfg, **/*.cfg, **.obo, **/*.obo"/>
      <!-- 3rd party libraries -->
      <zipfileset excludes="META-INF/**, **/package-info.class, **/package.html, **/*.java readme.txt LICENSE" src="${jsbml.dir}/core/lib/biojava-1.7-ontology.jar"/>
      <zipfileset excludes="META-INF/**, **/package-info.class, **/package.html, **/*.java" src="${jsbml.dir}/core/lib/jigsaw-dateParser.jar"/>
      <zipfileset excludes="META-INF/**, **/package-info.class, **/package.html, **/*.java" src="${jsbml.dir}/core/lib/log4j-1.2.8.jar"/>
      <zipfileset excludes="META-INF/**, **/package-info.class, **/package.html, **/*.java" src="${jsbml.dir}/core/lib/stax-api-1.0.1.jar"/>
      <zipfileset excludes="META-INF/**, **/package-info.class, **/package.html, **/*.java" src="${jsbml.dir}/core/lib/stax2-api-3.0.3.jar"/>
      <zipfileset excludes="META-INF/**, **/package-info.class, **/package.html, **/*.java" src="${jsbml.dir}/core/lib/staxmate-2.0.0.jar"/>
      <zipfileset excludes="META-INF/**, **/package-info.class, **/package.html, **/*.java" src="${jsbml.dir}/core/lib/woodstox-core-lgpl-4.0.9.jar"/>
      <zipfileset excludes="META-INF/**, **/package-info.class, **/package.html, **/*.java" src="${jsbml.dir}/core/lib/xstream-1.3.1.jar"/>
      <zipfileset excludes="META-INF/**, **/package-info.class, **/package.html, **/*.java" src="${jsbml.dir}/core/lib/spi-full-0.2.4.jar"/>
    </jar>
  	
  	<!-- Remove temporary file again: -->
  	<delete file="${jsbml.dir}/core/licenses/JSBML-AUTHORS.txt"/>
  	
  </target>

</project>
